## Разделение звеньев на разные файлы

До сих пор все примеры в этой главе определяли несколько звеньев в одном файле. Когда звенья становятся большими, вы можете захотеть переместить их определения в отдельные файлы, чтобы упростить навигацию по рукописи.

Например, давайте начнём с рукописи из приложения 7-17, в котором было несколько звеньев ресторана. Мы будем извлекать звенья в файлы вместо того, чтобы определять все звенья в корневом звене ящика. В нашем случае корневой звено ящика - *src/lib.rs*, но это разделение также работает и с двоичными ящиками, у которых корневой звено ящика — *src/main.rs*.

Сначала мы извлечём звено `front_of_house` в свой собственный файл. Удалите рукопись внутри узорчатых скобок для звена `front_of_house`, оставив только объявление `mod front_of_house;`, так что теперь *src/lib.rs* содержит рукопись, показанный в приложении 7-21. Обратите внимание, что этот исход не собирается, пока мы не создадим файл *src/front_of_house.rs* из приложении 7-22.

<span class="filename">Файл: src/lib.rs</span>

```rust,ignore,does_not_compile
{{#rustdoc_include ../listings/ch07-managing-growing-projects/listing-07-21-and-22/src/lib.rs}}
```

<span class="caption">Приложение 7-21. Объявление звена <code>front_of_house</code>, чьё содержимое будет в <em>src/front_of_house.rs</em></span>

Затем поместим рукопись, который был в узорчатых скобках, в новый файл с именем *src/front_of_house.rs*, как показано в приложении 7-22. Сборщик знает, что нужно искать в этом файле, потому что он наткнулся в корневом звене ящика на объявление звена с именем `front_of_house`.

<span class="filename">Файл: src/front_of_house.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/listing-07-21-and-22/src/front_of_house.rs}}
```

<span class="caption">Приложение 7-22. Определение содержимого звена <code>front_of_house</code> в файле <em>src/front_of_house.rs</em></span>

Обратите внимание, что вам нужно только *один раз* загрузить файл с помощью объявления `mod` в вашем дереве звеньев. Как только сборщик узнает, что файл является частью дела (и узнает, где в дереве звеньев находится рукопись из-за того, куда вы поместили указание `mod`), другие файлы в вашем деле должны ссылаться на рукопись загруженного файла, используя путь к месту, где он был объявлен, как описано в разделе [«Пути для ссылки на элемент в дереве звеньев»]<!-- ignore -->. Другими словами, `mod` — это *не* действие «включения», которую вы могли видеть в других языках программирования.

Далее мы извлечём звено `hosting` в его собственный файл. Этап немного отличается, потому что `hosting` является дочерним звеном для `front_of_house`, а не корневого звена. Мы поместим файл для `hosting` в новую папку, который будет назван по имени его предка в дереве звеньев, в данном случае это *src/front_of_house/*.

Чтобы начать перенос `hosting`, мы меняем *src/front_of_house.rs* так, чтобы он содержал только объявление звена `hosting`:

<span class="filename">Файл: src/front_of_house.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/no-listing-02-extracting-hosting/src/front_of_house.rs}}
```

Затем мы создаём папка *src/front_of_house* и файл *hosting.rs*, в котором будут  определения, сделанные в звене `hosting`:

<span class="filename">Файл: src/front_of_house/hosting.rs</span>

```rust,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/no-listing-02-extracting-hosting/src/front_of_house/hosting.rs}}
```

Если вместо этого мы поместим *hosting.rs* в папку *src*, сборщик будет думать, что рукопись в *hosting.rs* это звено `hosting`, объявленный в корне ящика, а не объявленный как дочернее звено `front_of_house`. Правила сборщика для проверки какие файлы содержат рукопись каких звеньев предполагают, что папки и файлы точно соответствуют дереву звеньев.

> ### Иные пути к файлам
>
> До сих пор мы рассматривали наиболее привычные пути к файлам, используемые сборщиком Ржавчина, но Ржавчина также поддерживает и старый исполнение пути к файлу. Для звена с именем `front_of_house`, объявленного в корневом звене ящика, сборщик будет искать рукопись звена в:
>
> - *src/front_of_house.rs* (что мы рассматривали)
> - *src/front_of_house/mod.rs* (старый исполнение, всё ещё поддерживаемый путь)
>
> Для звена с именем `hosting`, который является подзвеном `front_of_house`, сборщик будет искать рукопись звена в:
>
> - *src/front_of_house/hosting.rs* (что мы рассматривали)
> - *src/front_of_house/hosting/mod.rs* (старый исполнение, всё ещё поддерживаемый путь)
>
> Если вы используете оба исполнения для одного и того же звена, вы получите ошибку сборщика. Использование сочетания обоих исполнениий для разных звеньев в одном деле разрешено, но это может сбивать с толку людей, перемещающихся по вашему делу.
>
> Основным недостатком исполнения, в котором используются файлы с именами *mod.rs*, является то, что в вашем деле может оказаться много файлов с именами *mod.rs*, что может привести к путанице, если вы одновременно откроете их в редакторе.

Мы перенесли рукопись каждого звена в отдельный файл, а дерево звеньев осталось прежним. Вызовы функций в `eat_at_restaurant` будут работать без каких-либо изменений, несмотря на то, что определения находятся в разных файлах. Этот способ позволяет перемещать звенья в новые файлы по мере увеличения их размеров.

Обратите внимание, что указание `pub use crate::front_of_house::hosting` в *src/lib.rs* также не изменилась, и `use` не влияет на то, какие файлы собираются как часть ящика. Ключевое слово `mod` объявляет звенья, и Ржавчина ищет в файле с тем же именем, что и у звена, рукопись, который входит в этот звено.

## Итог

Ржавчина позволяет разбить дополнение на несколько ящиков и ящик - на звенья, так что вы можете ссылаться на элементы, определённые в одном звене, из другого звена. Это можно делать при помощи указания безусловных или относительных путей. Эти пути можно добавить в область видимости указанием `use`, поэтому вы можете пользоваться более короткими путями для многократного использования элементов в этой области видимости. Рукопись звена по умолчанию является закрытым, но можно сделать определения общедоступными, добавив ключевое слово `pub`.

В следующей главе мы рассмотрим некоторые собрания устройств данных из встроенной библиотеки, которые вы можете использовать в своём правильноно согласованном рукописи.


[«Пути для ссылки на элемент в дереве звеньев»]: ch07-03-paths-for-referring-to-an-item-in-the-module-tree.html